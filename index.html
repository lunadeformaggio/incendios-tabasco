<html>
  <head>
    <meta charset="utf-8" />
    <title>Incendios en Tabasco</title>
    <link rel="stylesheet" href="https://js.arcgis.com/4.34/esri/themes/dark/main.css"/>
     <script src="https://js.arcgis.com/4.34/"></script>


    
    <style>
      html,
      body{
        background-color: #202020;
        color: #ffffff;
      }
      #MiMapa{
        padding: 0;
         margin: 0;
          height: 100%;
          width: 100%;
          overflow: hidden;
      }


     /*//////////////////////////////////////////*/

    .esri-coordinate-conversion {
      transform: scale(0.85);   /*cambiar tamaño */
      backdrop-filter: blur(4px);
    }


      

     

    </style>

     <body>

    

     <div id="MiMapa"></div>

    
    <div id="timeSliderDiv" 
    style="
    position: absolute; 
    bottom: 20px; 
    left: 50%; 
    transform: translateX(-50%); 
    width: 50%; 
    z-index: 99;"></div>
     

      





    <script>
      require([
      "esri/config",
      "esri/Map",
      "esri/views/MapView",
      "esri/layers/GeoJSONLayer",
      "esri/widgets/LayerList",
      "esri/widgets/TimeSlider",
      "esri/widgets/CoordinateConversion",
      "esri/widgets/ScaleBar",
      "esri/widgets/Home"
      ], function(  //funciones en el mismo orden
        esriConfig,
        Map,
        MapView,
        GeoJSONLayer,
        LayerList,
        TimeSlider,
        CoordinateConversion,
        ScaleBar,
        Home
        ) {

        //API Key
        var esriConfig = {
            apiKey: "AAPTxy8BH1VEsoebNVZXo8HurBDOriv4mI9YGxT5IfEksbK95gl730cHPIkSo0fHkbtiLxNi9vPbFdo0NzbsKqrJCSBjSJx-l6fJD7QEFdWcxfwimxTdKJMmiipAN3PVSoaxA5DAYChZTGY0_iB8XtMGer3DdUSLQgWRaVWKCg4Q8VM4WN6womaxA-ckbljDYpgkNzK9GqTJfSEQ_A0iEigoM_AB2XfJ9E-Iyq_7RAeb8LM.AT1_srIXJxOu",
        };

        
      
        //declaración de variables
        const map = new Map({   //objeto mapa
          basemap: "satellite"
       });

        const view = new MapView({   //objeto vista
          container: "MiMapa", //ID del div
          map: map,
          center: [-92.9, 18.0], //longitud, latitud
          zoom: 9
        });

        
      


        ////////////// CAPAS //////////////


        //capa de límite de Tabasco

        const limite = new GeoJSONLayer({  
          url: "./data/Limite_Tabasco.geojson",
          title: "División Política de Tabasco",
          renderer: {
          type: "simple",
          symbol: {
          type: "simple-fill",
          color: [0,0,0,0],
          outline: { color: "white", width: 1.5 }
          }
          },
        });

        //capa de incendios de día

        const incendiosDia = new GeoJSONLayer({  
          url: "./data/Incendios_Vegetacion_Dia.geojson",
          title: "Incendios durante el día",
          timeInfo: {
            startField: "DATE_MX",   //campo de fecha para el time slider
             interval: {
              unit: "days",
              value: 1
            }
            },
          popupTemplate: {
            title: "Incendios durante el día",
            content: [
              {
                type: "fields",
                fieldInfos: [
                  {
                    fieldName: "LATITUDE",
                    label: "Latitud"
                  },
                  {
                    fieldName: "LONGITUDE",
                    label: "Longitud"
                  },
                  {
                    fieldName: "BRIGHTNESS",
                    label: "Temperatura de brillo (K)"
                  },
                  {
                    fieldName: "BRIGHT_T31",
                    label: "Temperatura del canal térmico T31"
                  },
                  {
                    fieldName: "DATE_MX",
                    label: "Fecha de detección (UTC-6)",
                    format: {                     //cambiar formato de fecha
                      dateFormat: "short-date"
                    }
                  },
                  {
                    fieldName: "HORA_MX",
                    label: "Hora de adquisición (UTC-6)",
                    format: {                     //cambiar formato de hora
                      timeFormat: "short-time"
                    }
                  },
                  {
                    fieldName: "SATELLITE",
                    label: "Satélite"
                  },
                  {
                    fieldName: "INSTRUMENT",
                    label: "Sensor"
                  },
                  {
                    fieldName: "FRP",
                    label: "Potencia radiante (MW)"
                  },
                  {
                    fieldName: "DAYNIGHT",
                    label: "Detección de día o noche"
                  },
                    {
                    fieldName: "SCAN",
                    label: "Tamaño del pixel en dirección de escaneo (m)"
                  },
                  {
                    fieldName: "TRACK",
                    label: "Tamaño del pixel en dirección de trayectoria (m)"
                  }
                ],
              }
            ]
          },
          renderer: {
          type: "simple",
          symbol: {
          type: "simple-marker",
          color: "#B2ACF2",
          outline: null,
          size: 6,
          }
          },
          featureReduction: {   //Configuración de agrupamiento de puntos
            type: "cluster", 
            clusterRadius: "50px",
            clusterMinSize: "16px",
            clusterMaxSize: "32px",
            symbol: {
            type: "simple-marker",
            color: "#B2ACF2",
            outline: null
          },
            labelingInfo: [{
            deconflictionStrategy: "none",
            labelExpressionInfo: {
            expression: "Text($feature.cluster_count, '#,###')"
          },
            symbol: {
              type: "text",
             color: "white",
             font: { size: 10, weight: "bold" }
             },
           labelPlacement: "center-center"
            }]
           }
          });

        //capa de incendios de noche

        const incendiosNoche = new GeoJSONLayer({  
          url: "./data/Incendios_Vegetacion_Noche.geojson",
          title: "Incendios durante la noche",
          timeInfo: {
            startField: "DATE_MX",   //campo de fecha para el time slider
            interval: {
              unit: "days",
              value: 1
             }
             },
          popupTemplate: {
            title: "Incendios durante la noche",
            content: [
              {
                type: "fields",
                fieldInfos: [
                  {
                    fieldName: "LATITUDE",
                    label: "Latitud"
                  },
                  {
                    fieldName: "LONGITUDE",
                    label: "Longitud"
                  },
                  {
                    fieldName: "BRIGHTNESS",
                    label: "Temperatura de brillo (K)"
                  },
                  {
                    fieldName: "BRIGHT_T31",
                    label: "Temperatura del canal térmico T31"
                  },
                  {
                    fieldName: "DATE_MX",
                    label: "Fecha de detección (UTC-6)",
                    format: {                     //cambiar formato de fecha
                      dateFormat: "short-date"
                    }
                  },
                  {
                    fieldName: "HORA_MX",
                    label: "Hora de adquisición (UTC-6)",
                    format: {                     //cambiar formato de hora
                      timeFormat: "short-time"
                    }
                  },
                  {
                    fieldName: "SATELLITE",
                    label: "Satélite"
                  },
                  {
                    fieldName: "INSTRUMENT",
                    label: "Sensor"
                  },
                  {
                    fieldName: "FRP",
                    label: "Potencia radiante (MW)"
                  },
                  {
                    fieldName: "DAYNIGHT",
                    label: "Detección de día o noche"
                  },
                    {
                    fieldName: "SCAN",
                    label: "Tamaño del pixel en dirección de escaneo (m)"
                  },
                  {
                    fieldName: "TRACK",
                    label: "Tamaño del pixel en dirección de trayectoria (m)"
                  }
                ],
              }
            ]
          },
          renderer: {
          type: "simple",
          symbol: {
          type: "simple-marker",
          color: "#F2B9AC",
          outline: null,
          size: 4,
          }
          },
          featureReduction: {   //Configuración de agrupamiento de puntos
            type: "cluster", 
            clusterRadius: "50px",
            clusterMinSize: "16px",
            clusterMaxSize: "32px",
            symbol: {
            type: "simple-marker",
            color: "#F2B9AC",
            outline: null
          },
            labelingInfo: [{
            deconflictionStrategy: "none",
            labelExpressionInfo: {
            expression: "Text($feature.cluster_count, '#,###')"
          },
            symbol: {
              type: "text",
             color: "white",
             font: { size: 10, weight: "bold" }
             },
           labelPlacement: "center-center"
            }]
           }
          });

       //Agregar capas al mapa
        map.add(limite);  
        map.add(incendiosDia);
        map.add(incendiosNoche);  



        ////////////// WIDGETS //////////////

        //Agregar Layer List
        const layerList = new LayerList({
          view: view,
          icon: "layers"
        });

        //Agregar Scale Bar
        const scaleBar = new ScaleBar({
          view: view,
          barStyle: "line",
          unit: "metric",
          width: 136
        });

        //Agregar Coordinate Conversion
        const ccWidget = new CoordinateConversion({
          view: view,
          orientation: "auto"
        });

        //Agregar time slider
        const timeSlider = new TimeSlider({
          view: view,
          container: "timeSliderDiv",  //Declarar en Div externo
          mode: "time-window",
          timevisible: true,
          playRate: 500,
          fullTimeExtent: {
            start: new Date(2025, 0, 1),
            end: new Date(2025, 11, 31)
          },
          stops: {
            interval: {
              value: 1,
              unit: "days"
            }
          },
        });

        //Inicializar time extent al cargar la vista
        timeSlider.timeExtent = {
          start: new Date(2025, 0, 1),
          end: new Date(2025, 11, 31)
        };

        


        //Agregar widgets al view
       
        view.ui.add(layerList, {
          position: "top-right"
        });
        view.ui.add(scaleBar, {
          position: "bottom-left"
        });
        view.ui.add(ccWidget, {
          position: "bottom-right"
        });
        view.ui.add(new timeSlider, {
          position: "bottom-center"
        });
        


    });
    </script>
  </head>

 


  </body>  
</html>

  
